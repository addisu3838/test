<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <title>Project with Expert Chat</title>
    <style>
        /* === RESET & VARIABLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        :root {
            --primary: #1e2b37;
            --primary-light: #2c3e50;
            --accent: #27ae60;
            --danger: #e74c3c;
            --info: #3498db;
            --warning: #f39c12;
            --bg: #f0f5f8;
            --card-bg: #ffffff;
            --text-dark: #1e2b37;
            --text-soft: #2c3e50;
            --border-light: #e9edf2;
            --income: #27ae60;
            --cost: #e74c3c;
            --profit: #2980b9;
            --header-gradient: linear-gradient(145deg, #1a2632, #2c3e50);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --chat-user: #dcf8c6;
            --chat-expert: #e3f2fd;
            --chat-system: #f5f5f5;
        }

        body {
            background: var(--bg);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .app-wrapper {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            border-radius: 0;
        }

        .content-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 2px 0 80px 0;
            background: white;
        }

        /* === FLOATING BOTTOM TABS (4 tabs) === */
        .floating-footer {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            pointer-events: none;
            z-index: 1000;
            padding: 0 8px;
        }

        .floating-tabs {            
            padding: 5px 5px;
            border-radius: 59px;
            display: flex;
            gap: 4px;
            box-shadow: 0 4px 20px rgba(159, 241, 6, 0.3);
            pointer-events: auto;
            border: 1px solid rgba(184, 248, 66, 0.2);
            backdrop-filter: blur(10px); 
            background-color: white;                      
        }

        .nav-btn {
            background: rgba(147, 243, 103, 0.15);
            border: 1px solid rgba(25, 231, 94, 0.3);
            color: #000000;
            padding: 9px 12px;
            border-radius: 150px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 2px;
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 65px;
            justify-content: center;
        }

        .nav-btn span {
            font-size: 10px;
        }

        .nav-btn.active {
            background: #0077ff;
            border-color: rgb(17, 1, 1);
            color: rgb(3, 0, 0);
            box-shadow: 0 2px 12px #eef1f380;
            transform: scale(1.05);
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        /* === INCOME TABLE === */
        .table-container {
            padding: 8px 6px;
        }

        .mobile-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            font-size: 13px;
        }

        .mobile-table thead tr {
            background: var(--header-gradient);
        }

        .mobile-table th {
            color: white;
            font-weight: 600;
            font-size: 12px;
            padding: 16px 6px;
            text-align: left;
            letter-spacing: 0.3px;
            white-space: nowrap;
            background: #1e2b37;
        }

        .mobile-table td {
            padding: 12px 6px;
            border-bottom: 1px solid var(--border-light);
            vertical-align: middle;
            background: white;
        }

        .mobile-table tr:last-child td {
            border-bottom: none;
        }

        .bill-section {
            background: linear-gradient(145deg, #71e654, #ffe0b2) !important;
            font-weight: 800;
            border-left: 6px solid #e3fa92;
            border-right: 6px solid #f4f774;
        }
        
        .bill-section td {
            background: transparent !important;
            font-size: 15px;
            color: #e2f59d;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .bill-highlight {
            background: linear-gradient(145deg, #7eb305, #ffe082) !important;
            border-left: 8px solid #a5b9fc;
            border-right: 8px solid #5d79f5;
        }
        
        .bill-highlight td {
            background: transparent !important;
            font-size: 16px;
            color: #23ce0c;
            text-shadow: 0 1px 1px rgba(255,255,255,0.5);
        }

        .item-no {
            font-weight: 700;
            color: var(--primary-light);
            font-size: 11px;
            background: #f0f4fa;
            display: inline-block;
            padding: 3px 8px;
            border-radius: 30px;
            white-space: nowrap;
        }

        .work-description {
            font-size: 13px;
            line-height: 1.45;
            color: #1e2b37;
            max-width: 400px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .achievement-cell {
            font-weight: 500;
            color: #4a5a6a;
            text-align: right;
            font-size: 12px;
            white-space: nowrap;
        }

        .income-value {
            color: var(--income);
            font-weight: 700;
            font-size: 12px;
            text-align: right;
            white-space: nowrap;
        }

        /* === SOS DASHBOARD === */
        .sos-dashboard {
            padding: 11px;
            background-image: url('https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
            min-height: 100%;
        }
        
        .sos-dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.85);
            z-index: 0;
            pointer-events: none;
        }
        
        .sos-dashboard > * {
            position: relative;
            z-index: 1;
        }

        .sos-header {
            color: black;
            padding: 14px 15px;
            border-radius: 18px;
            margin-bottom: 10px;
            box-shadow: var(--shadow-md);
            background-color: rgba(203, 235, 216, 0.9);
            backdrop-filter: blur(5px);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 18px;
            padding: 16px;
            margin: 15px 0;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(5px);
        }
        
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .bar-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 12px;
            border-radius: 12px;
        }
        
        .bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .bar-bg {
            background: #ecf0f1;
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            width: 100%;
        }
        
        .bar-fill {
            height: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: white;
            font-size: 11px;
            font-weight: 600;
            transition: width 0.3s ease;
        }

        .sos-table-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 14px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            margin-top: 15px;
            backdrop-filter: blur(5px);
        }

        .sos-data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 15px;
        }
        .sos-data-table th {
            background: #227bf0;
            color: white;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 16px;
        }
        .sos-data-table td {
            padding: 15px 15px;
            border-bottom: 1px solid #f0f0f0;
            font-weight: 700;
        }

        .text-success {
            color: #27ae60;
            font-weight: 600;
        }

        .text-danger {
            color: #e74c3c;
            font-weight: 600;
        }

        /* === COMPARISON DASHBOARD === */
        .comparison-dashboard {
            padding: 16px;
            background: #faf2ad;
        }

        .column-chart-container {
            background:white;
            border-radius: 6px;
            padding: 6px 8px;
            margin: 12px 0 13px 0;
            overflow-x: auto;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .column-chart {
            display: flex;
            align-items: flex-end;
            gap: 3px;
            min-width: 60px;
            height: 250px;
            padding: 5px 0 0 0;
            border-bottom: 2px solid #ddd;
            position: relative;
        }

        .chart-column-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 60px;
        }

        .column-bar {
            width: 50%;
            background: linear-gradient(180deg, rgb(75, 241, 10), #eeff01);
            border-radius: 8px 8px 0 0;
            transition: height 0.3s ease;
            position: relative;
            min-height: 4px;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            border: 1px solid #074392;
            border-bottom: none;
        }

        .column-value {
            font-size: 12px;
            font-weight: 700;
            margin-top: 5px;
            color: #ff7700;
            background: rgba(255,255,255,0.9);
            padding: 2px 6px;
            border-radius: 20px;
            white-space: nowrap;
        }

        .column-label {
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
            color: #2c3e50;
            text-align: center;
            word-break: break-word;
            max-width: 80px;
        }

        .cost-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin-bottom: 25px;
        }

        .cost-table th {
            background: #7172bd;
            color: white;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .cost-table td {
            padding: 14px 12px;
            border-bottom: 1px solid #f0f0f0;
            font-weight: 500;
        }

        .cost-table .total-row {
            background: #2c3e50;
            color: white;
            font-weight: 700;
        }

        /* === CHAT TAB STYLES === */
        .chat-dashboard {
            background: #f5f5f5;
            min-height: 100%;
            display: flex;
            flex-direction: column;
            padding-bottom: 20px;
        }
        
        .chat-header {
            background: var(--header-gradient);
            color: white;
            padding: 20px 16px;
            border-radius: 0 0 20px 20px;
            box-shadow: var(--shadow-md);
            margin-bottom: 10px;
        }
        
        .chat-header h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chat-header p {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            background: #f5f5f5;
        }
        
        .message {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        
        .message.user {
            align-items: flex-end;
        }
        
        .message.expert {
            align-items: flex-start;
        }
        
        .message.system {
            align-items: center;
        }
        
        .message-header {
            font-size: 11px;
            color: #666;
            margin-bottom: 2px;
            padding: 0 8px;
        }
        
        .message-content {
            padding: 12px 16px;
            border-radius: 20px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
            max-width: 85%;
        }
        
        .message.user .message-content {
            background: var(--chat-user);
            border-bottom-right-radius: 5px;
            color: #000;
        }
        
        .message.expert .message-content {
            background: var(--chat-expert);
            border-bottom-left-radius: 5px;
            color: #000;
        }
        
        .message.system .message-content {
            background: var(--chat-system);
            border-radius: 30px;
            color: #666;
            font-size: 12px;
            font-style: italic;
            max-width: 90%;
            text-align: center;
        }
        
        .message-time {
            font-size: 10px;
            color: #999;
            margin-top: 4px;
            padding: 0 8px;
        }
        
        .chat-input-container {
            background: white;
            padding: 16px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: center;
            border-radius: 30px 30px 0 0;
            margin: 0 16px;
            box-shadow: var(--shadow-sm);
        }
        
        .chat-input {
            flex: 1;
            border: 1px solid #e0e0e0;
            border-radius: 25px;
            padding: 12px 18px;
            font-size: 14px;
            outline: none;
            transition: border 0.2s;
        }
        
        .chat-input:focus {
            border-color: #0077ff;
        }
        
        .chat-send-btn {
            background: #0077ff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
        }
        
        .chat-send-btn:active {
            transform: scale(0.95);
            background: #0055cc;
        }
        
        .expert-controls {
            background: white;
            margin: 10px 16px;
            padding: 16px;
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .expert-controls h3 {
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .expert-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .expert-input {
            flex: 1;
            border: 1px solid #e0e0e0;
            border-radius: 25px;
            padding: 12px 18px;
            font-size: 14px;
            outline: none;
        }
        
        .expert-select {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 25px;
            font-size: 13px;
            background: white;
        }
        
        .expert-send-btn {
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .expert-send-btn:active {
            transform: scale(0.95);
            background: #219a52;
        }
        
        .pending-questions {
            background: white;
            margin: 10px 16px;
            padding: 16px;
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .pending-questions h3 {
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .pending-item {
            background: #fff9e6;
            border-left: 4px solid #f39c12;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 12px;
        }
        
        .pending-question {
            font-size: 13px;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .pending-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: #666;
        }
        
        .reply-btn {
            background: #0077ff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 6px 16px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .fade-in {
            animation: fadeIn 0.25s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0.4; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 480px) {
            .nav-btn {
                padding: 8px 10px;
                font-size: 12px;
                min-width: 60px;
            }
            .floating-tabs {
                gap: 4px;
                padding: 5px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <div class="content-container" id="contentContainer"></div>

        <!-- Floating Bottom Tabs -->
        <div class="floating-footer">
            <div class="floating-tabs">
                <button class="nav-btn active" data-tab="monthly">
                    <span>üìÖ</span> Income
                </button>
                <button class="nav-btn" data-tab="comparison">
                    <span>üìä</span> Cost
                </button>
                <button class="nav-btn" data-tab="sos">
                    <span>‚ö†Ô∏è</span> SOS
                </button>
                <button class="nav-btn" data-tab="chat">
                    <span>üí¨</span> Chat
                </button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // ---------- PROJECT DATA ----------
            const projectData = [
                { itemNo: "BILL A", description: "GENERAL ITEMES", isBillSection: true, isHighlightBill: true },
                { itemNo: "1.12.8", description: "Allow for supplying temporary electricity, water, telephone and other utility bills...", achievement: 0.72, total: "9141575.07295305" },
                { itemNo: "1.13.3", description: "Provisions of security", achievement: 0.72, total: "1425815.46702017" },
                { itemNo: "1.12", description: "Allow for expenses required for conducting compensation payment estimation...", achievement: 0.12, total: "425000" },
                { itemNo: "BILL B", description: "MAIN DAM", isBillSection: true, isHighlightBill: true },
                { itemNo: "2.3.1", description: "Fill and compaction the Core zone with clay material...", achievement: 36679.05, total: "10617117.813"},
                { itemNo: "2.4.1", description: "Fill and compaction the Shell zone with selected material...", achievement: 52913.7, total: "13807300.878"},
                { itemNo: "2.5.1", description: "Filter material (Finer) supply and fill...", achievement: 8299.13, total: "10231167.464"},
                { itemNo: "2.5.2", description: "Filter material (coarser) supply and fill...", achievement: 3916, total: "4836455.8"},
                { itemNo: "2.6.1", description: "Fill and compaction zone 4 with Rock material", achievement: 52477.76, total: "44596650.00"},
                { itemNo: "BILL C", description: "GROUTING AND FAULT TREATMENT", isBillSection: true },
                { itemNo: "3.A.1", description: "Mobilization and Demoblization", achievement: 0.5, total: "292789.65" }
            ];

            // ---------- SOS DATA ----------
            const sosData = [
                { period: "July-1-Feb-15", executed: 100160343.81029, cost: 229221250.779779 },
                { period: "July-1-Feb-15", executed: 367814911.473582, cost: 229221250.779779 }
            ];

            // ---------- COMPARISON DATA ----------
            const comparisonCostData = {
                labour: { used: 3697032.51 },
                admin: 11475708.95,
                staff: 8985423.57,
                material: { used: 70572471.46 },
                machinery: { used: 111908472.09 },
                overhead: 22559885.15,
                totalUsed: 229198993.73,
            };

            // ---------- CHAT DATA ----------
            // ·àÅ·àâ·àù ·ã®·âª·âµ ·àò·àç·ä•·ä≠·â∂·âΩ ·ã®·àö·âÄ·àò·å°·â†·âµ array
            window.chatMessages = [
                { 
                    type: 'system', 
                    text: '·à∞·àã·àù ·â†·ã∞·àÖ·äì ·àò·å°! ·ä•·â£·ä≠·ãé ·å•·ã´·âÑ·ãé·äï ·ã≠·åª·çâ·ç¢ ·â£·àà·àô·ã´·âΩ·äï ·â†·â∞·âª·àà ·çç·å•·äê·âµ ·ã≠·àò·àç·à±·àç·ãé·â≥·àç·ç¢',
                    time: new Date().toLocaleTimeString()
                }
            ];
            
            // ·ã´·àç·â∞·àò·àà·à± ·å•·ã´·âÑ·ãé·âΩ
            window.pendingQuestions = [];

            // ---------- Helper Functions ----------
            function formatCurrency(val) {
                if (!val) return "‚Äî";
                let num = parseFloat(val);
                if (isNaN(num)) return val.toString();
                return num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }

            function formatAchievement(val) {
                if (!val) return "‚Äî";
                let n = parseFloat(val);
                if (isNaN(n)) return val.toString();
                return n.toFixed(2);
            }

            function formatCompactCurrency(val) {
                if (!val) return "‚Äî";
                let num = parseFloat(val);
                if (isNaN(num)) return val.toString();
                if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
                if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
                if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
                return num.toFixed(0);
            }

            // ---------- INCOME TAB ----------
            function loadMonthlyTable() {
                const container = document.getElementById('contentContainer');
                
                let tableRows = '';
                projectData.forEach(item => {
                    let rowClass = '';
                    if (item.isBillSection) {
                        rowClass = item.isHighlightBill ? 'bill-highlight' : 'bill-section';
                    }
                    
                    const incomeNum = parseFloat(String(item.total).replace(/,/g, '')) || 0;
                    
                    tableRows += `
                        <tr class="${rowClass}">
                            <td><span class="item-no">${item.itemNo || '‚Äî'}</span></td>
                            <td><div class="work-description">${item.description}</div></td>
                            <td><div class="achievement-cell">${item.achievement ? formatAchievement(item.achievement) : '‚Äî'}</div></td>
                            <td><div class="income-value">${item.total ? formatCurrency(incomeNum) : '‚Äî'}</div></td>
                        </tr>
                    `;
                });

                container.innerHTML = `
                    <div class="table-container fade-in">
                        <table class="mobile-table">
                            <thead>
                                <tr>
                                    <th>Item No.</th>
                                    <th>Work Description</th>
                                    <th>Achieved</th>
                                    <th>Income (Birr)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            // ---------- SOS TAB ----------
            function loadSosTab() {
                const container = document.getElementById('contentContainer');
                
                const maxExecuted = Math.max(...sosData.map(d => d.executed));
                const maxCost = Math.max(...sosData.map(d => d.cost));
                
                container.innerHTML = `
                    <div class="sos-dashboard fade-in">
                        <div class="sos-header">
                            <h2><span>‚ö†Ô∏è</span> SOS Report</h2>
                            <p>Total Plan Birr = 123,569,87456</p>
                        </div>
                        
                        <div class="chart-container">
                            <div class="chart-title">üìä Executed vs Cost Comparison</div>
                            <div class="bar-chart">
                                ${sosData.map((item, index) => {
                                    const executedPercent = (item.executed / maxExecuted) * 100;
                                    const costPercent = (item.cost / maxCost) * 100;
                                    return `
                                        <div class="bar-item">
                                            <div class="bar-label">
                                                <span>Period ${index + 1}</span>
                                                <span>${formatCurrency(item.executed)} / ${formatCurrency(item.cost)}</span>
                                            </div>
                                            <div style="display: flex; gap: 10px;">
                                                <div style="flex:1">
                                                    <div style="font-size:11px;color:#27ae60;">Executed</div>
                                                    <div class="bar-bg"><div class="bar-fill" style="width:${executedPercent}%;background:#27ae60;">${Math.round(executedPercent)}%</div></div>
                                                </div>
                                                <div style="flex:1">
                                                    <div style="font-size:11px;color:#e74c3c;">Cost</div>
                                                    <div class="bar-bg"><div class="bar-fill" style="width:${costPercent}%;background:#e74c3c;">${Math.round(costPercent)}%</div></div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <div class="sos-table-container">
                            <table class="sos-data-table">
                                <tr><th>Period</th><th>Executed</th><th>Cost</th></tr>
                                ${sosData.map(item => `
                                    <tr>
                                        <td>${item.period}</td>
                                        <td class="text-success">${formatCurrency(item.executed)}</td>
                                        <td class="text-danger">${formatCurrency(item.cost)}</td>
                                    </tr>
                                `).join('')}
                            </table>
                        </div>
                    </div>
                `;
            }

            // ---------- COMPARISON TAB ----------
            function loadComparisonTab() {
                const container = document.getElementById('contentContainer');
                const d = comparisonCostData;

                const usedItems = [
                    { name: 'Labour', value: d.labour.used, icon: 'üë∑' },
                    { name: 'Admin', value: d.admin, icon: 'üèõÔ∏è' },
                    { name: 'Staff', value: d.staff, icon: 'üë•' },
                    { name: 'Material', value: d.material.used, icon: 'üß±' },
                    { name: 'Machinery', value: d.machinery.used, icon: 'üöú' },
                    { name: 'Overhead', value: d.overhead, icon: 'üìä' }
                ];

                const maxValue = Math.max(...usedItems.map(item => item.value));
                const maxHeight = 200;

                container.innerHTML = `
                    <div class="comparison-dashboard fade-in">
                        <h2>üìä Cost Overview</h2>
                        <div class="column-chart-container">
                            <div class="column-chart">
                                ${usedItems.map(item => {
                                    const height = (item.value / maxValue) * maxHeight;
                                    return `
                                        <div class="chart-column-wrapper">
                                            <div class="column-bar" style="height:${height}px"></div>
                                            <div class="column-value">${formatCompactCurrency(item.value)}</div>
                                            <div class="column-label">${item.icon} ${item.name}</div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <table class="cost-table">
                            <tr><th>Category</th><th>Used (Birr)</th></tr>
                            <tr><td>üë∑ Labour</td><td>${formatCurrency(d.labour.used)}</td></tr>
                            <tr><td>üèõÔ∏è Admin</td><td>${formatCurrency(d.admin)}</td></tr>
                            <tr><td>üë• Staff</td><td>${formatCurrency(d.staff)}</td></tr>
                            <tr><td>üß± Material</td><td>${formatCurrency(d.material.used)}</td></tr>
                            <tr><td>üöú Machinery</td><td>${formatCurrency(d.machinery.used)}</td></tr>
                            <tr><td>üìä Overhead</td><td>${formatCurrency(d.overhead)}</td></tr>
                            <tr class="total-row"><td><strong>TOTAL</strong></td><td>${formatCurrency(d.totalUsed)}</td></tr>
                        </table>
                    </div>
                `;
            }

            // ---------- CHAT TAB (·àÅ·àâ·àù ·å•·ã´·âÑ·ãé·âΩ ·ã®·àö·â≥·ã©·â†·âµ) ----------
            function loadChatTab() {
                const container = document.getElementById('contentContainer');
                
                // ·àÅ·àâ·äï·àù ·àò·àç·ä•·ä≠·â∂·âΩ ·ä†·à≥·ã≠
                const messagesHtml = window.chatMessages.map(msg => `
                    <div class="message ${msg.type}">
                        <div class="message-header">${msg.type === 'user' ? '·ä•·à≠·àµ·ãé' : msg.type === 'expert' ? '·â£·àà·àô·ã´' : '·à≤·àµ·â∞·àù'}</div>
                        <div class="message-content">${msg.text}</div>
                        <div class="message-time">${msg.time || ''}</div>
                    </div>
                `).join('');
                
                // ·ã´·àç·â∞·àò·àà·à± ·å•·ã´·âÑ·ãé·âΩ·äï ·ä†·à≥·ã≠
                const pendingHtml = window.pendingQuestions.map((q, index) => `
                    <div class="pending-item">
                        <div class="pending-question">${q.text}</div>
                        <div class="pending-meta">
                            <span>${q.time}</span>
                            <button class="reply-btn" onclick="replyToQuestion(${index})">·àò·àç·àµ ·àµ·å•</button>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = `
                    <div class="chat-dashboard fade-in">
                        <div class="chat-header">
                            <h2><span>üí¨</span> ·ã®·â£·àà·àô·ã´·ãé·âΩ ·âª·âµ</h2>
                            <p>·å•·ã´·âÑ·ãé·âΩ·ãé·äï ·ã≠·åª·çâ·ç£ ·â£·àà·àô·ã´·âΩ·äï ·ã≠·àò·àç·à±·àç·ãé·â≥·àç</p>
                        </div>
                        
                        <!-- ·ã®·â∞·å†·âÉ·àö ·àò·àç·ä•·ä≠·âµ ·àò·àã·ä™·ã´ -->
                        <div class="chat-input-container">
                            <input type="text" class="chat-input" id="userQuestion" placeholder="·å•·ã´·âÑ·ãé·äï ·ã≠·åª·çâ..." />
                            <button class="chat-send-btn" id="sendQuestionBtn">‚û§</button>
                        </div>
                        
                        <!-- ·àà·â£·àà·àô·ã´ ·àò·àç·àµ ·àò·àµ·å´ -->
                        <div class="expert-controls">
                            <h3>üë®‚Äçüíº ·ã®·â£·àà·àô·ã´ ·àò·àç·àµ</h3>
                            <div class="expert-input-group">
                                <input type="text" class="expert-input" id="expertReply" placeholder="·àò·àç·àµ·ãé·äï ·ã≠·åª·çâ..." />
                                <select class="expert-select" id="expertName">
                                    <option value="·ä¢·äï·åÇ·äê·à≠ ·ä†·àà·àõ·ã®·àÅ">·ä¢·äï·åÇ·äê·à≠ ·ä†·àà·àõ·ã®·àÅ</option>
                                    <option value="·ä¢·äï·åÇ·äê·à≠ ·à≥·àô·ä§·àç">·ä¢·äï·åÇ·äê·à≠ ·à≥·àô·ä§·àç</option>
                                    <option value="·ä¢·äï·åÇ·äê·à≠ ·àõ·à≠·âÜ·àµ">·ä¢·äï·åÇ·äê·à≠ ·àõ·à≠·âÜ·àµ</option>
                                </select>
                            </div>
                            <button class="expert-send-btn" id="sendReplyBtn">·àò·àç·àµ ·àã·ä≠</button>
                        </div>
                        
                        <!-- ·ã´·àç·â∞·àò·àà·à± ·å•·ã´·âÑ·ãé·âΩ -->
                        ${pendingHtml ? `
                            <div class="pending-questions">
                                <h3>‚è≥ ·ã´·àç·â∞·àò·àà·à± ·å•·ã´·âÑ·ãé·âΩ</h3>
                                ${pendingHtml}
                            </div>
                        ` : ''}
                        
                        <!-- ·àÅ·àâ·àù ·àò·àç·ä•·ä≠·â∂·âΩ -->
                        <div class="chat-messages" id="chatMessages">
                            ${messagesHtml}
                        </div>
                    </div>
                `;

                // ·ã®·â∞·å†·âÉ·àö ·å•·ã´·âÑ ·àò·àã·ä™·ã´
                document.getElementById('sendQuestionBtn').addEventListener('click', sendUserQuestion);
                document.getElementById('userQuestion').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendUserQuestion();
                });

                // ·ã®·â£·àà·àô·ã´ ·àò·àç·àµ ·àò·àã·ä™·ã´
                document.getElementById('sendReplyBtn').addEventListener('click', sendExpertReply);
            }

            // ·ã®·â∞·å†·âÉ·àö ·å•·ã´·âÑ ·àò·àã·ä≠
            function sendUserQuestion() {
                const input = document.getElementById('userQuestion');
                const question = input.value.trim();
                
                if (!question) return;
                
                // ·å•·ã´·âÑ·ãç·äï ·ãà·ã∞ ·àò·àç·ä•·ä≠·â∂·âΩ ·å®·àù·à≠
                window.chatMessages.push({
                    type: 'user',
                    text: question,
                    time: new Date().toLocaleTimeString()
                });
                
                // ·å•·ã´·âÑ·ãç·äï ·ãà·ã∞ ·ã´·àç·â∞·àò·àà·à± ·å•·ã´·âÑ·ãé·âΩ ·å®·àù·à≠
                window.pendingQuestions.push({
                    text: question,
                    time: new Date().toLocaleTimeString()
                });
                
                input.value = '';
                
                // ·âª·â±·äï ·ä•·äï·ã∞·åà·äì ·å´·äï
                loadChatTab();
                
                // ·ãà·ã∞ ·àò·àç·ä•·ä≠·â∂·âΩ ·àò·å®·à®·àª ·ãç·à∞·ãµ
                setTimeout(() => {
                    const messages = document.getElementById('chatMessages');
                    if (messages) messages.scrollTop = messages.scrollHeight;
                }, 100);
            }

            // ·ã®·â£·àà·àô·ã´ ·àò·àç·àµ ·àò·àã·ä≠
            function sendExpertReply() {
                const replyInput = document.getElementById('expertReply');
                const expertName = document.getElementById('expertName').value;
                const reply = replyInput.value.trim();
                
                if (!reply) return;
                
                // ·àò·àç·à±·äï ·ãà·ã∞ ·àò·àç·ä•·ä≠·â∂·âΩ ·å®·àù·à≠
                window.chatMessages.push({
                    type: 'expert',
                    text: `${expertName}: ${reply}`,
                    time: new Date().toLocaleTimeString()
                });
                
                // ·ä†·äï·ãµ ·ã´·àç·â∞·àò·àà·à∞ ·å•·ã´·âÑ ·ä´·àà ·ä†·àµ·ãà·åç·ãµ (·ã®·àò·åÄ·àò·à™·ã´·ãç·äï)
                if (window.pendingQuestions.length > 0) {
                    window.pendingQuestions.shift();
                }
                
                replyInput.value = '';
                
                // ·âª·â±·äï ·ä•·äï·ã∞·åà·äì ·å´·äï
                loadChatTab();
                
                // ·ãà·ã∞ ·àò·àç·ä•·ä≠·â∂·âΩ ·àò·å®·à®·àª ·ãç·à∞·ãµ
                setTimeout(() => {
                    const messages = document.getElementById('chatMessages');
                    if (messages) messages.scrollTop = messages.scrollHeight;
                }, 100);
            }

            // ·àà·å•·ã´·âÑ ·àò·àç·àµ ·àà·àò·àµ·å†·âµ (global function)
            window.replyToQuestion = function(index) {
                // ·ã®·â∞·àò·à®·å†·ãç·äï ·å•·ã´·âÑ ·ãà·ã∞ ·â£·àà·àô·ã´ ·àò·àç·àµ ·â¶·ä≠·àµ ·å®·àù·à≠
                setTimeout(() => {
                    const expertReply = document.getElementById('expertReply');
                    if (expertReply) {
                        expertReply.value = '·àà·å•·ã´·âÑ·ãç ·àò·àç·àµ·ç° ';
                        expertReply.focus();
                    }
                }, 100);
            };

            // ---------- Tab Switching ----------
            function switchTab(tab) {
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`.nav-btn[data-tab="${tab}"]`).classList.add('active');

                if (tab === 'monthly') loadMonthlyTable();
                else if (tab === 'sos') loadSosTab();
                else if (tab === 'comparison') loadComparisonTab();
                else if (tab === 'chat') loadChatTab();
            }

            // Event listeners
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    switchTab(e.currentTarget.dataset.tab);
                });
            });

            // Initialize
            document.addEventListener('DOMContentLoaded', () => {
                loadMonthlyTable();
            });
        })();
    </script>
</body>
</html>