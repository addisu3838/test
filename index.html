<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <title>Project Manager ‚Ä¢ ·â†·â∞·äñ·âΩ ·ä†·â•·à®·ãç ·ä•·äï·ã∞·ã≠·äï·âÉ·à≥·âÉ·à±</title>
    <style>
        /* === RESET & VARIABLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        :root {
            --primary: #1e2b37;
            --primary-light: #2c3e50;
            --accent: #27ae60;
            --danger: #e74c3c;
            --info: #3498db;
            --warning: #f39c12;
            --bg: #f0f5f8;
            --card-bg: #ffffff;
            --text-dark: #1e2b37;
            --text-soft: #2c3e50;
            --border-light: #e9edf2;
            --income: #27ae60;
            --cost: #e74c3c;
            --profit: #2980b9;
            --header-gradient: linear-gradient(145deg, #1a2632, #2c3e50);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
        }

        body {
            background: var(--bg);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .app-wrapper {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            border-radius: 0;
        }

        .content-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 4px 0 80px 0;
            background: #eef2f5;
        }

        /* === FLOATING BOTTOM TABS (only 3) === */
        .floating-footer {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            pointer-events: none;
            z-index: 1000;
            padding: 0 16px;
        }

        .floating-tabs {
            background: var(--header-gradient);
            padding: 8px 16px;
            border-radius: 50px;
            display: flex;
            gap: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            pointer-events: auto;
            border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: #eef3f7;
            padding: 12px 24px;
            border-radius: 40px;
            font-size: 16px;
            font-weight: 700;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 110px;
            justify-content: center;
        }

        .nav-btn span {
            font-size: 20px;
        }

        .nav-btn.active {
            background: #3498db;
            border-color: white;
            color: white;
            box-shadow: 0 2px 12px #3498db80;
            transform: scale(1.05);
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        /* === DISCUSSION FAB === */
        .discussion-fab {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(231,76,60,0.4);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.2s ease;
            border: 2px solid white;
        }

        .discussion-fab:active {
            transform: scale(0.95);
        }

        .discussion-fab span {
            font-size: 28px;
        }

        .discussion-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f39c12;
            color: white;
            border-radius: 20px;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 700;
            border: 2px solid white;
        }

        /* === DISCUSSION PANEL === */
        .discussion-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            display: none;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }

        .discussion-panel.active {
            display: flex;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .discussion-header {
            background: var(--header-gradient);
            color: white;
            padding: 20px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .discussion-header h3 {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-discussion {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 20px;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .discussion-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #dee2e6;
            padding: 0 10px;
        }

        .discussion-tab {
            flex: 1;
            padding: 14px 10px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
            cursor: pointer;
        }

        .discussion-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .discussion-tab span {
            margin-left: 6px;
            background: #ecf0f1;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .discussion-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: #f5f7fa;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            display: flex;
            gap: 10px;
            max-width: 85%;
        }

        .message.own {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message-content {
            background: white;
            padding: 12px;
            border-radius: 18px;
            border-top-left-radius: 4px;
            box-shadow: var(--shadow-sm);
        }

        .message.own .message-content {
            background: #3498db;
            color: white;
            border-top-left-radius: 18px;
            border-top-right-radius: 4px;
        }

        .message-sender {
            font-weight: 700;
            font-size: 13px;
            margin-bottom: 4px;
            color: #2c3e50;
        }

        .message.own .message-sender {
            color: rgba(255,255,255,0.9);
        }

        .message-text {
            font-size: 14px;
            line-height: 1.5;
            word-break: break-word;
        }

        .message-time {
            font-size: 11px;
            color: #95a5a6;
            margin-top: 4px;
            text-align: right;
        }

        .discussion-input-area {
            background: white;
            padding: 16px;
            border-top: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .discussion-input {
            flex: 1;
            border: 1px solid #dee2e6;
            border-radius: 24px;
            padding: 12px 18px;
            font-size: 14px;
            resize: none;
            max-height: 120px;
            min-height: 50px;
            outline: none;
        }

        .send-message-btn {
            background: #3498db;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            flex-shrink: 0;
        }

        /* === INCOME TABLE (FULL DATA) === */
        .table-container {
            padding: 8px 6px;
        }

        .mobile-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            font-size: 13px;
        }

        .mobile-table thead tr {
            background: var(--header-gradient);
        }

        .mobile-table th {
            color: white;
            font-weight: 600;
            font-size: 12px;
            padding: 16px 6px;
            text-align: left;
            letter-spacing: 0.3px;
            white-space: nowrap;
            background: #1e2b37;
        }

        .mobile-table td {
            padding: 12px 6px;
            border-bottom: 1px solid var(--border-light);
            vertical-align: middle;
            background: white;
        }

        .mobile-table tr:last-child td {
            border-bottom: none;
        }

        .item-no {
            font-weight: 700;
            color: var(--primary-light);
            font-size: 12px;
            background: #f0f4fa;
            display: inline-block;
            padding: 3px 8px;
            border-radius: 30px;
            white-space: nowrap;
        }

        .work-description {
            font-size: 12px;
            line-height: 1.45;
            color: #1e2b37;
            max-width: 190px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            cursor: pointer;
        }

        .achievement-cell {
            font-weight: 500;
            color: #4a5a6a;
            text-align: right;
            font-size: 12px;
            white-space: nowrap;
            cursor: pointer;
        }

        .income-value {
            color: var(--income);
            font-weight: 700;
            font-size: 12px;
            text-align: right;
            white-space: nowrap;
            letter-spacing: -0.2px;
            cursor: pointer;
        }

        .cost-value {
            color: var(--cost);
            font-weight: 700;
            font-size: 12px;
            text-align: right;
            white-space: nowrap;
            display: none;
            cursor: pointer;
        }

        .cost-column .cost-value {
            display: block;
        }

        /* === SOS DASHBOARD (FULL DATA) === */
        .sos-dashboard {
            padding: 16px;
            background: #f8fafc;
        }

        .sos-header {
            background: linear-gradient(145deg, #c0392b, #e74c3c);
            color: white;
            padding: 24px 20px;
            border-radius: 28px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            cursor: pointer;
        }

        .sos-header h2 {
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .sos-date {
            background: rgba(255,255,255,0.2);
            display: inline-block;
            padding: 6px 16px;
            border-radius: 40px;
            margin-top: 12px;
            font-size: 14px;
            font-weight: 500;
        }

        .summary-cards {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .card-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .card-row .card {
            flex: 1 1 calc(50% - 6px);
            min-width: 160px;
        }

        .card {
            background: white;
            border-radius: 24px;
            padding: 18px 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0,0,0,0.03);
            cursor: pointer;
        }

        .card.labour {
            border-left: 5px solid #f39c12;
        }
        .card.admin {
            border-left: 5px solid #9b59b6;
        }
        .card.staff {
            border-left: 5px solid #3498db;
        }
        .card.material {
            border-left: 5px solid #27ae60;
        }
        .card.machinery {
            border-left: 5px solid #e67e22;
        }
        .card.overhead {
            border-left: 5px solid #e74c3c;
        }
        .card.total {
            background: linear-gradient(145deg, #2c3e50, #34495e);
            color: white;
            border: none;
        }

        .card-title {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #7f8c8d;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .card-value {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .card-sub {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #2c3e50;
        }

        .card.total .card-sub {
            color: rgba(255,255,255,0.9);
        }

        .comparison-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 600;
        }

        .badge-positive {
            background: #d4edda;
            color: #155724;
        }

        .badge-negative {
            background: #f8d7da;
            color: #721c24;
        }

        .progress-bar-container {
            background: #ecf0f1;
            height: 8px;
            border-radius: 10px;
            margin: 12px 0 8px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-labour { background: #f39c12; }
        .progress-material { background: #27ae60; }
        .progress-machinery { background: #e67e22; }

        .sos-table {
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin-top: 24px;
        }

        .sos-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .sos-table th {
            background: #e74c3c;
            color: white;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .sos-table td {
            padding: 14px 12px;
            border-bottom: 1px solid #f0f0f0;
            font-weight: 500;
        }

        .sos-table .total-row {
            background: #2c3e50;
            color: white;
            font-weight: 700;
        }

        .sos-table .total-row td {
            background: #2c3e50;
        }

        .text-danger { color: #e74c3c; }
        .text-success { color: #27ae60; }

        /* === COMPARISON DASHBOARD (FULL DATA) === */
        .comparison-dashboard {
            padding: 16px;
            background: #f0f7ff;
        }

        .comparison-header {
            background: linear-gradient(145deg, #2980b9, #3498db);
            color: white;
            padding: 24px 20px;
            border-radius: 28px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            cursor: pointer;
        }

        .comparison-header h2 {
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .income-summary {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .income-card {
            background: white;
            border-radius: 24px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
        }

        .income-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 12px;
        }

        .income-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px dashed #ecf0f1;
        }

        .income-label {
            font-size: 15px;
            color: #5f7485;
            font-weight: 500;
        }

        .income-amount {
            font-size: 18px;
            font-weight: 700;
        }

        .progress-large {
            height: 12px;
            background: #ecf0f1;
            border-radius: 20px;
            margin: 15px 0 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            border-radius: 20px;
        }

        .escalet-card {
            background: linear-gradient(145deg, #f39c12, #e67e22);
            color: white;
            border-radius: 24px;
            padding: 24px;
            margin: 20px 0;
            box-shadow: var(--shadow-md);
            cursor: pointer;
        }

        .escalet-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .escalet-row:last-child {
            border-bottom: none;
        }

        .escalet-label {
            font-size: 16px;
            font-weight: 500;
            opacity: 0.9;
        }

        .escalet-value {
            font-size: 24px;
            font-weight: 800;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 16px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
        }

        .stat-card .stat-label {
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .stat-card .stat-value {
            font-size: 20px;
            font-weight: 800;
        }

        .fade-in {
            animation: fadeIn 0.25s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0.4; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 480px) {
            .nav-btn {
                padding: 10px 16px;
                font-size: 14px;
                min-width: 80px;
            }
            .floating-tabs {
                gap: 6px;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <div class="content-container" id="contentContainer"></div>

        <!-- Floating Bottom Tabs (only 3) -->
        <div class="floating-footer">
            <div class="floating-tabs">
                <button class="nav-btn active" data-tab="monthly">
                    <span>üìÖ</span> Income
                </button>
                <button class="nav-btn" data-tab="sos">
                    <span>‚ö†Ô∏è</span> SOS
                </button>
                <button class="nav-btn" data-tab="comparison">
                    <span>üìä</span> Comparison
                </button>
            </div>
        </div>

        <!-- Discussion FAB -->
        <div class="discussion-fab" id="discussionFab" onclick="toggleDiscussionPanel()">
            <span>üí¨</span>
            <div class="discussion-badge" id="unreadBadge">3</div>
        </div>

        <!-- Discussion Panel -->
        <div class="discussion-panel" id="discussionPanel">
            <div class="discussion-header">
                <h3><span>üí¨</span> ·ãç·ã≠·ã≠·âµ / Discussion</h3>
                <button class="close-discussion" onclick="toggleDiscussionPanel()">‚úï</button>
            </div>
            
            <div class="discussion-tabs">
                <button class="discussion-tab active" data-chat="general" onclick="switchChat('general')">
                    üë• ·ä†·å†·âÉ·àã·ã≠ <span id="generalCount">2</span>
                </button>
                <button class="discussion-tab" data-chat="project" onclick="switchChat('project')">
                    üìã ·çï·àÆ·åÄ·ä≠·âµ <span id="projectCount">1</span>
                </button>
            </div>

            <div class="discussion-messages" id="discussionMessages"></div>

            <div class="discussion-input-area">
                <textarea class="discussion-input" id="messageInput" placeholder="·àÄ·à≥·â•·ãé·äï ·ã´·àµ·åà·â°... ·â†·â∞·äñ·âΩ ·ä†·â•·à®·ãç ·ä•·äï·ã∞·ã≠·äï·âÉ·à≥·âÉ·à±" rows="1"></textarea>
                <button class="send-message-btn" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // ---------- COMPLETE PROJECT DATA (24 items) ----------
            const projectData = [
                { itemNo: "1.12.8", description: "Allow for supplying temporary electricity, water, telephone and other utility bills for the supervisor's and contractor's including connection, distribution system for the work, internal arrangements and all payment to the authorities for connections. it is the responsibility of the contractor to ensure steady and uninterrupted power supply to work", achievement: 0.72, total: "9141575.07295305", cost: "100000" },
                { itemNo: "1.13.3", description: "Provisions of security", achievement: 0.72, total: "1425815.46702017", cost: "280000" },
                { itemNo: "1.12", description: "Allow for expenses required for conducting compensation payment estimation such as periderm for Committee, fuel cost, printing expenses and other related expenses. Payment shall be paid up on approval of the Engineer keeping all legal procedures. The costs will be reimbursed to the contractor after receiving the original invoice in the payment certificate by the Consultant", achievement: 0.12, total: "425000", cost: "350000" },
                { itemNo: "3.A.1", description: "Mobilization and Demoblization", achievement: 0.5, total: "292789.65", cost: "168000" },
                { itemNo: "2.3.1", description: "Fill and compaction the Core zone with clay material with max hauling distance of 5 Km", achievement: 29479.5, total: "8533136.07", cost: "121000" },
                { itemNo: "2.4.1", description: "Fill and compaction the Shell zone with selected material, max hauling distance of 5 Km", achievement: 43277.3, total: "11292778.662", cost: "72000" },
                { itemNo: "2.5.1", description: "Filter material (Finer) supply and fill(zone 2A)", achievement: 6643.13, total: "8189650.664", cost: "96000" },
                { itemNo: "2.5.2", description: "Filter material (coarser) supply and fill(zone 2B)", achievement: 3020, total: "3729851", cost: "36000" },
                { itemNo: "2.5.4", description: "Riprap(zone 5)", achievement: 2329.54, total: "1890631.3686", cost: "14400" },
                { itemNo: "2.6.1", description: "Fill and compaction zone 4 with Rock material", achievement: 48677.76, total: "41367334.0032", cost: "3600" },
                { itemNo: "", description: "production of rock", achievement: 53248, total: "", cost: "" },
                { itemNo: "2.9.4", description: "Vibrating Wire Piezometer with its complete accessories in embankment", achievement: 3, total: "561600", cost: "3600" },
                { itemNo: "2.9.5", description: "Vibrating Wire settlement sensor with complete accessories", achievement: 2, total: "41367334.0032", cost: "3600" },
                { itemNo: "2.9.8", description: "Vibrating wire cable", achievement: 307.94, total: "288231.84", cost: "3600" },
                { itemNo: "4.2.4", description: "Base slab", achievement: 3.17, total: "16324.64064", cost: "3600" },
                { itemNo: "8.5.1", description: "C-25 concrete work including formwork", achievement: 8.5, total: "45602.5", cost: "3600" },
                { itemNo: "8.5.3", description: "Reinforcement bars (bending, cutting & placing)", achievement: 48677.76, total: "19046.358", cost: "3600" },
                { itemNo: "11.7.1", description: "Ordinary soil excavation", achievement: 156.6, total: "12935.16", cost: "3600" },
                { itemNo: "11.7.2", description: "Basaltic or equivalent stone masonry work in cement sand mortar of 1:3 mix ratio", achievement: 404.811, total: "932097.56805", cost: "3600" },
                { itemNo: "11.7.3", description: "C-25 concrete mixing, placing, vibrating and curing for slab including formwork", achievement: 32.8, total: "194254.72", cost: "3600" },
                { itemNo: "11.7.4", description: "Reinforcement bars of √∏10mm as specified on the drawings with 150mm spacing", achievement: 156.6, total: "103830.33", cost: "3600" },
                { itemNo: "New", description: "Reinforcement bar of Dia 12mm as specified on the drawing with 200mm spacing", achievement: 3663.2, total: "250343.088", cost: "3600" },
                { itemNo: "11.7.6", description: "Cart away excavated material", achievement: 96, total: "4304.64", cost: "3600" },
                { itemNo: "11.7.8", description: "Back fill with shell material around the ditch", achievement: 480, total: "4304.64", cost: "3600" }
            ];

            // ---------- COMPLETE SOS DATA ----------
            const sosData = {
                labour: { required: 2892620.98, used: 2924176.31 },
                admin: 8499476.64,
                staff: 7593612.57,
                material: { required: 52668615.30, used: 50677145.73 },
                machinery: { required: 78138494.08, used: 82049518.29 },
                overhead: 21323070.23,
                totalRequired: 149535837.67,
                totalUsed: 173066999.76
            };

            // ---------- COMPLETE COMPARISON DATA ----------
            const comparisonData = {
                plan1: 260209082.32,
                executed1: 88659790.48,
                plan2: 283476359.20,
                executed2: 93976269.21,
                escaletPlan1: 998963173.297,
                escaletExecuted1: 322376225.247,
                escaletPlan2: 1090892184.251,
                escaletExecuted2: 343381632.721
            };

            // ---------- Discussion System ----------
            let currentChat = 'general';
            let messages = {
                general: [
                    { id: 1, sender: '·ä†·â•·ã≠', text: '·ä•·äï·ä≥·äï ·ã∞·àÖ·äì ·àò·å£·âΩ·àÅ! ·â†·çï·àÆ·åÄ·ä≠·â± ·àã·ã≠ ·ä†·â•·à®·äï ·ä•·äï·ãà·ã´·ã≠', time: new Date(Date.now() - 3600000).toISOString(), own: false, avatar: '·ä†' },
                    { id: 2, sender: '·à≥·à´', text: '·ã®·àò·à≥·à™·ã´·ãé·âΩ ·ãà·å™ ·âµ·äï·àΩ ·å®·àù·àØ·àç·ç¢ ·ä•·äï·ã¥·âµ ·ä•·äì·àµ·â∞·ä´·ä≠·àà·ãç?', time: new Date(Date.now() - 1800000).toISOString(), own: false, avatar: '·à≥' },
                    { id: 3, sender: '·ä•·äî', text: '·ä•·àµ·â≤ ·â†SOS ·âµ·à≠ ·àã·ã≠ ·ã´·àà·ãç·äï ·àò·à®·åÉ ·ä•·äï·àò·àç·ä®·âµ', time: new Date().toISOString(), own: true, avatar: '·ä•' }
                ],
                project: [
                    { id: 101, sender: '·ã∞·à≥·àà·äù', text: '·ã®·ã∞·à®·åÉ 1 ·åà·â¢ ·ä•·âÖ·ãµ 260M ·äê·ãç·ç¢ 88.6M ·â•·âª ·â∞·çà·åΩ·àü·àç', time: new Date(Date.now() - 7200000).toISOString(), own: false, avatar: '·ã∞' },
                    { id: 102, sender: '·ä•·äî', text: '·ä•·äï·ã¥·âµ ·àõ·àª·àª·àç ·ä•·äï·âΩ·àã·àà·äï?', time: new Date(Date.now() - 3600000).toISOString(), own: true, avatar: '·ä•' }
                ]
            };

            let lastMessageId = 102;
            let costVisible = false;

            // Keyboard shortcut for cost column
            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey && event.key === 'c') {
                    event.preventDefault();
                    costVisible = !costVisible;
                    const table = document.getElementById('workTable');
                    if (table) {
                        if (costVisible) table.classList.add('cost-column');
                        else table.classList.remove('cost-column');
                    }
                }
            });

            function formatMessageTime(isoString) {
                const date = new Date(isoString);
                const diffMins = Math.floor((Date.now() - date) / 60000);
                if (diffMins < 1) return '·ä†·àÅ·äï';
                if (diffMins < 60) return `${diffMins} ·ã∞·âÇ·âÉ ·â†·çä·âµ`;
                if (diffMins < 1440) return `${Math.floor(diffMins / 60)} ·à∞·ãì·âµ ·â†·çä·âµ`;
                return `${Math.floor(diffMins / 1440)} ·âÄ·äï ·â†·çä·âµ`;
            }

            function renderMessages() {
                const container = document.getElementById('discussionMessages');
                const chatMessages = messages[currentChat] || [];
                
                container.innerHTML = chatMessages.map(msg => `
                    <div class="message ${msg.own ? 'own' : ''}">
                        <div class="message-avatar">${msg.avatar}</div>
                        <div class="message-content">
                            <div class="message-sender">${msg.sender}</div>
                            <div class="message-text">${msg.text}</div>
                            <div class="message-time">${formatMessageTime(msg.time)}</div>
                        </div>
                    </div>
                `).join('');
                
                container.scrollTop = container.scrollHeight;
            }

            window.switchChat = function(chatId) {
                currentChat = chatId;
                document.querySelectorAll('.discussion-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.chat === chatId);
                });
                renderMessages();
            };

            window.sendMessage = function() {
                const input = document.getElementById('messageInput');
                const text = input.value.trim();
                if (!text) return;
                
                messages[currentChat].push({
                    id: ++lastMessageId,
                    sender: '·ä•·äî',
                    text: text,
                    time: new Date().toISOString(),
                    own: true,
                    avatar: '·ä•'
                });
                
                renderMessages();
                input.value = '';
            };

            window.toggleDiscussionPanel = function() {
                document.getElementById('discussionPanel').classList.toggle('active');
                if (document.getElementById('discussionPanel').classList.contains('active')) {
                    renderMessages();
                }
            };

            // ---------- Helper Functions ----------
            function formatCurrency(val) {
                if (val === '' || val === undefined || val === null) return "‚Äî";
                let str = String(val).replace(/,/g, '');
                let num = parseFloat(str);
                if (isNaN(num)) return val.toString();
                return num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }

            function formatAchievement(val) {
                if (val === '' || val === undefined) return "‚Äî";
                let n = parseFloat(val);
                if (isNaN(n)) return val.toString();
                if (n % 1 === 0) return n.toString();
                return n.toFixed(2);
            }

            function calculatePercentage(executed, plan) {
                return ((executed / plan) * 100).toFixed(1);
            }

            // ---------- INCOME TAB (FULL DATA) ----------
            function loadMonthlyTable() {
                const container = document.getElementById('contentContainer');
                container.innerHTML = `
                    <div class="table-container fade-in">
                        <table class="mobile-table ${costVisible ? 'cost-column' : ''}" id="workTable">
                            <thead>
                                <tr>
                                    <th>Item No.</th>
                                    <th>Work Description</th>
                                    <th>Achievement</th>
                                    <th>Income (Birr)</th>
                                    <th>Cost (Birr)</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                ${projectData.map(item => {
                                    const incomeNum = parseFloat(String(item.total).replace(/,/g, '')) || 0;
                                    const costNum = parseFloat(String(item.cost).replace(/,/g, '')) || 0;
                                    return `
                                        <tr>
                                            <td><span class="item-no" onclick="toggleDiscussionPanel()">${item.itemNo || '‚Äî'}</span></td>
                                            <td><div class="work-description" onclick="toggleDiscussionPanel()" title="${item.description.replace(/"/g, '&quot;')}">${item.description}</div></td>
                                            <td><div class="achievement-cell" onclick="toggleDiscussionPanel()">${formatAchievement(item.achievement)}</div></td>
                                            <td><div class="income-value" onclick="toggleDiscussionPanel()">${formatCurrency(incomeNum)}</div></td>
                                            <td><div class="cost-value" onclick="toggleDiscussionPanel()">${formatCurrency(costNum)}</div></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            // ---------- SOS TAB (FULL DATA) ----------
            function loadSosTab() {
                const container = document.getElementById('contentContainer');
                const d = sosData;
                
                const labourVar = d.labour.used - d.labour.required;
                const materialVar = d.material.used - d.material.required;
                const machineryVar = d.machinery.used - d.machinery.required;
                const totalVar = d.totalUsed - d.totalRequired;

                const labourPercent = (d.labour.used / d.labour.required * 100).toFixed(1);
                const materialPercent = (d.material.used / d.material.required * 100).toFixed(1);
                const machineryPercent = (d.machinery.used / d.machinery.required * 100).toFixed(1);

                container.innerHTML = `
                    <div class="sos-dashboard fade-in">
                        <div class="sos-header" onclick="toggleDiscussionPanel()">
                            <h2><span>‚ö†Ô∏è</span> SOS Report</h2>
                            <p>Emergency Cost Overview ‚Ä¢ Project Health Monitor</p>
                            <div class="sos-date">üìÖ Q2 2025 ‚Ä¢ Week 26</div>
                        </div>

                        <div class="summary-cards">
                            <div class="card-row">
                                <div class="card labour" onclick="toggleDiscussionPanel()">
                                    <div class="card-title">üë∑ Labour</div>
                                    <div class="card-value">${formatCurrency(d.labour.used)}</div>
                                    <div class="card-sub">
                                        <span>Req: ${formatCurrency(d.labour.required)}</span>
                                        <span class="${labourVar > 0 ? 'text-danger' : 'text-success'}">${labourVar > 0 ? '+' : ''}${formatCurrency(labourVar)}</span>
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar progress-labour" style="width: ${labourPercent}%;"></div>
                                    </div>
                                    <div><span class="comparison-badge ${labourVar > 0.05 ? 'badge-negative' : 'badge-positive'}">${labourPercent}% of required</span></div>
                                </div>
                                <div class="card admin" onclick="toggleDiscussionPanel()">
                                    <div class="card-title">üèõÔ∏è Admin Cost</div>
                                    <div class="card-value">${formatCurrency(d.admin)}</div>
                                    <div class="card-sub">Fixed overhead</div>
                                </div>
                            </div>

                            <div class="card-row">
                                <div class="card staff" onclick="toggleDiscussionPanel()">
                                    <div class="card-title">üë• Staff</div>
                                    <div class="card-value">${formatCurrency(d.staff)}</div>
                                    <div class="card-sub">Full team</div>
                                </div>
                                <div class="card material" onclick="toggleDiscussionPanel()">
                                    <div class="card-title">üß± Material</div>
                                    <div class="card-value">${formatCurrency(d.material.used)}</div>
                                    <div class="card-sub">
                                        <span>Req: ${formatCurrency(d.material.required)}</span>
                                        <span class="${materialVar > 0 ? 'text-danger' : 'text-success'}">${materialVar > 0 ? '+' : ''}${formatCurrency(materialVar)}</span>
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar progress-material" style="width: ${materialPercent}%;"></div>
                                    </div>
                                    <div><span class="comparison-badge ${materialVar > 0.05 ? 'badge-negative' : 'badge-positive'}">${materialPercent}%</span></div>
                                </div>
                            </div>

                            <div class="card-row">
                                <div class="card machinery" onclick="toggleDiscussionPanel()">
                                    <div class="card-title">üöú Machinery</div>
                                    <div class="card-value">${formatCurrency(d.machinery.used)}</div>
                                    <div class="card-sub">
                                        <span>Req: ${formatCurrency(d.machinery.required)}</span>
                                        <span class="${machineryVar > 0 ? 'text-danger' : 'text-success'}">${machineryVar > 0 ? '+' : ''}${formatCurrency(machineryVar)}</span>
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar progress-machinery" style="width: ${machineryPercent}%;"></div>
                                    </div>
                                    <div><span class="comparison-badge ${machineryVar > 0.05 ? 'badge-negative' : 'badge-positive'}">${machineryPercent}%</span></div>
                                </div>
                                <div class="card overhead" onclick="toggleDiscussionPanel()">
                                    <div class="card-title">üìä Overhead (20%)</div>
                                    <div class="card-value">${formatCurrency(d.overhead)}</div>
                                    <div class="card-sub">Indirect costs</div>
                                </div>
                            </div>

                            <div class="card total" onclick="toggleDiscussionPanel()">
                                <div class="card-title">üí∞ TOTAL PROJECT COST</div>
                                <div style="display: flex; justify-content: space-between; align-items: baseline;">
                                    <span style="font-size: 32px; font-weight: 800;">${formatCurrency(d.totalUsed)}</span>
                                    <span style="font-size: 16px; opacity: 0.8;">${((d.totalUsed/d.totalRequired - 1)*100).toFixed(1)}% vs plan</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 15px;">
                                    <span>Required: ${formatCurrency(d.totalRequired)}</span>
                                    <span class="${totalVar > 0 ? 'text-danger' : 'text-success'}">${totalVar > 0 ? 'üî∫+' : 'üîª'}${formatCurrency(Math.abs(totalVar))}</span>
                                </div>
                                <div class="progress-bar-container" style="background: #4a5a6a;">
                                    <div class="progress-bar" style="width: ${(d.totalUsed/d.totalRequired)*100}%; background: #f1c40f;"></div>
                                </div>
                            </div>
                        </div>

                        <div class="sos-table" onclick="toggleDiscussionPanel()">
                            <table>
                                <thead><tr><th>Category</th><th>Required (Birr)</th><th>Used (Birr)</th><th>Variance</th><th>%</th></tr></thead>
                                <tbody>
                                    <tr><td><strong>üë∑ Labour</strong></td><td>${formatCurrency(d.labour.required)}</td><td>${formatCurrency(d.labour.used)}</td><td class="${labourVar>0?'text-danger':'text-success'}">${labourVar>0?'+':''}${formatCurrency(labourVar)}</td><td>${labourPercent}%</td></tr>
                                    <tr><td><strong>üèõÔ∏è Admin</strong></td><td>‚Äî</td><td>${formatCurrency(d.admin)}</td><td>‚Äî</td><td>‚Äî</td></tr>
                                    <tr><td><strong>üë• Staff</strong></td><td>${formatCurrency(d.staff)}</td><td>${formatCurrency(d.staff)}</td><td class="text-success">0.00</td><td>100%</td></tr>
                                    <tr><td><strong>üß± Material</strong></td><td>${formatCurrency(d.material.required)}</td><td>${formatCurrency(d.material.used)}</td><td class="${materialVar>0?'text-danger':'text-success'}">${materialVar>0?'+':''}${formatCurrency(materialVar)}</td><td>${materialPercent}%</td></tr>
                                    <tr><td><strong>üöú Machinery</strong></td><td>${formatCurrency(d.machinery.required)}</td><td>${formatCurrency(d.machinery.used)}</td><td class="${machineryVar>0?'text-danger':'text-success'}">${machineryVar>0?'+':''}${formatCurrency(machineryVar)}</td><td>${machineryPercent}%</td></tr>
                                    <tr><td><strong>üìä Overhead (20%)</strong></td><td>‚Äî</td><td>${formatCurrency(d.overhead)}</td><td>‚Äî</td><td>‚Äî</td></tr>
                                    <tr class="total-row"><td><strong>TOTAL</strong></td><td>${formatCurrency(d.totalRequired)}</td><td>${formatCurrency(d.totalUsed)}</td><td>${totalVar>0?'+':''}${formatCurrency(totalVar)}</td><td>${((d.totalUsed/d.totalRequired)*100).toFixed(1)}%</td></tr>
                                </tbody>
                            </table>
                        </div>

                        ${totalVar > 0 ? `
                        <div style="background: #fbe9e7; border-left: 6px solid #e74c3c; padding: 16px; border-radius: 16px; margin-top: 20px;" onclick="toggleDiscussionPanel()">
                            <span style="font-weight:700; color:#c0392b;">‚ö†Ô∏è Overspend Alert</span>
                            <p style="margin-top:6px; font-size:14px;">Total cost exceeds planned budget by ${formatCurrency(totalVar)} (${((d.totalUsed/d.totalRequired-1)*100).toFixed(1)}%). Review machinery & labour.</p>
                        </div>
                        ` : ''}
                    </div>
                `;
            }

            // ---------- COMPARISON TAB (FULL DATA) ----------
            function loadComparisonTab() {
                const container = document.getElementById('contentContainer');
                const d = comparisonData;
                
                const totalPlan = d.plan1 + d.plan2;
                const totalExecuted = d.executed1 + d.executed2;
                const totalEscaletPlan = d.escaletPlan1 + d.escaletPlan2;
                const totalEscaletExecuted = d.escaletExecuted1 + d.escaletExecuted2;
                
                const overallPlan = totalPlan + totalEscaletPlan;
                const overallExecuted = totalExecuted + totalEscaletExecuted;
                const overallPercentage = (overallExecuted / overallPlan * 100).toFixed(1);

                container.innerHTML = `
                    <div class="comparison-dashboard fade-in">
                        <div class="comparison-header" onclick="toggleDiscussionPanel()">
                            <h2><span>üìä</span> Income Comparison</h2>
                            <p>Plan vs Executed ‚Ä¢ Escalation Included</p>
                            <div class="sos-date">üìÖ Fiscal Year 2025</div>
                        </div>

                        <div class="income-summary">
                            <div class="income-card" onclick="toggleDiscussionPanel()">
                                <div class="income-card-title">
                                    <span>üìã Phase 1 Income</span>
                                </div>
                                <div class="income-row">
                                    <span class="income-label">Plan (Birr)</span>
                                    <span class="income-amount">${formatCurrency(d.plan1)}</span>
                                </div>
                                <div class="income-row">
                                    <span class="income-label">Executed (Birr)</span>
                                    <span class="income-amount" style="color: #27ae60;">${formatCurrency(d.executed1)}</span>
                                </div>
                                <div class="progress-large">
                                    <div class="progress-fill" style="width: ${calculatePercentage(d.executed1, d.plan1)}%;"></div>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                                    <span style="font-size: 14px; color: #5f7485;">Completion</span>
                                    <span style="font-weight: 700; color: #2980b9;">${calculatePercentage(d.executed1, d.plan1)}%</span>
                                </div>
                                <div style="background: #f0f7ff; padding: 12px; border-radius: 16px; margin-top: 12px;">
                                    <span style="font-weight:600;">Variance: </span>
                                    <span class="${(d.executed1 - d.plan1) > 0 ? 'text-success' : 'text-danger'}">
                                        ${formatCurrency(Math.abs(d.executed1 - d.plan1))} ${(d.executed1 - d.plan1) > 0 ? 'above' : 'below'} plan
                                    </span>
                                </div>
                            </div>

                            <div class="income-card" onclick="toggleDiscussionPanel()">
                                <div class="income-card-title">
                                    <span>üìã Phase 2 Income</span>
                                </div>
                                <div class="income-row">
                                    <span class="income-label">Plan (Birr)</span>
                                    <span class="income-amount">${formatCurrency(d.plan2)}</span>
                                </div>
                                <div class="income-row">
                                    <span class="income-label">Executed (Birr)</span>
                                    <span class="income-amount" style="color: #27ae60;">${formatCurrency(d.executed2)}</span>
                                </div>
                                <div class="progress-large">
                                    <div class="progress-fill" style="width: ${calculatePercentage(d.executed2, d.plan2)}%;"></div>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                                    <span style="font-size: 14px; color: #5f7485;">Completion</span>
                                    <span style="font-weight: 700; color: #2980b9;">${calculatePercentage(d.executed2, d.plan2)}%</span>
                                </div>
                                <div style="background: #f0f7ff; padding: 12px; border-radius: 16px; margin-top: 12px;">
                                    <span style="font-weight:600;">Variance: </span>
                                    <span class="${(d.executed2 - d.plan2) > 0 ? 'text-success' : 'text-danger'}">
                                        ${formatCurrency(Math.abs(d.executed2 - d.plan2))} ${(d.executed2 - d.plan2) > 0 ? 'above' : 'below'} plan
                                    </span>
                                </div>
                            </div>

                            <div class="escalet-card" onclick="toggleDiscussionPanel()">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 20px;">
                                    <span style="font-size: 24px;">üìà</span>
                                    <span style="font-size: 20px; font-weight: 700;">Escalation Income</span>
                                </div>
                                <div class="escalet-row">
                                    <span class="escalet-label">Phase 1 Plan</span>
                                    <span class="escalet-value">${formatCurrency(d.escaletPlan1)}</span>
                                </div>
                                <div class="escalet-row">
                                    <span class="escalet-label">Phase 1 Executed</span>
                                    <span class="escalet-value">${formatCurrency(d.escaletExecuted1)}</span>
                                </div>
                                <div style="height: 1px; background: rgba(255,255,255,0.2); margin: 12px 0;"></div>
                                <div class="escalet-row">
                                    <span class="escalet-label">Phase 2 Plan</span>
                                    <span class="escalet-value">${formatCurrency(d.escaletPlan2)}</span>
                                </div>
                                <div class="escalet-row">
                                    <span class="escalet-label">Phase 2 Executed</span>
                                    <span class="escalet-value">${formatCurrency(d.escaletExecuted2)}</span>
                                </div>
                            </div>

                            <div class="comparison-grid">
                                <div class="stat-card" onclick="toggleDiscussionPanel()">
                                    <div class="stat-label">Total Plan</div>
                                    <div class="stat-value">${formatCurrency(totalPlan)}</div>
                                    <div class="stat-sub">Base Income</div>
                                </div>
                                <div class="stat-card" onclick="toggleDiscussionPanel()">
                                    <div class="stat-label">Total Executed</div>
                                    <div class="stat-value" style="color: #27ae60;">${formatCurrency(totalExecuted)}</div>
                                    <div class="stat-sub">${calculatePercentage(totalExecuted, totalPlan)}% of plan</div>
                                </div>
                                <div class="stat-card" onclick="toggleDiscussionPanel()">
                                    <div class="stat-label">Escalation Plan</div>
                                    <div class="stat-value">${formatCurrency(totalEscaletPlan)}</div>
                                    <div class="stat-sub">Total Escalation</div>
                                </div>
                                <div class="stat-card" onclick="toggleDiscussionPanel()">
                                    <div class="stat-label">Escalation Exec.</div>
                                    <div class="stat-value" style="color: #f39c12;">${formatCurrency(totalEscaletExecuted)}</div>
                                    <div class="stat-sub">${calculatePercentage(totalEscaletExecuted, totalEscaletPlan)}% achieved</div>
                                </div>
                            </div>

                            <div class="card total" style="margin-top: 16px;" onclick="toggleDiscussionPanel()">
                                <div class="card-title">üéØ OVERALL INCOME (Base + Escalation)</div>
                                <div style="display: flex; justify-content: space-between; align-items: baseline;">
                                    <span style="font-size: 28px; font-weight: 800;">${formatCurrency(overallExecuted)}</span>
                                    <span style="font-size: 16px; opacity: 0.8;">${overallPercentage}% of plan</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 12px;">
                                    <span>Total Plan: ${formatCurrency(overallPlan)}</span>
                                    <span class="${overallExecuted > overallPlan ? 'text-success' : 'text-danger'}">
                                        ${overallExecuted > overallPlan ? '‚ñ≤' : '‚ñº'} ${formatCurrency(Math.abs(overallExecuted - overallPlan))}
                                    </span>
                                </div>
                                <div class="progress-bar-container" style="background: #4a5a6a; margin-top: 16px;">
                                    <div class="progress-bar" style="width: ${overallPercentage}%; background: #f1c40f;"></div>
                                </div>
                            </div>

                            <div class="sos-table" style="margin-top: 24px;" onclick="toggleDiscussionPanel()">
                                <table>
                                    <thead><tr><th>Category</th><th>Plan (Birr)</th><th>Executed (Birr)</th><th>Achievement</th></tr></thead>
                                    <tbody>
                                        <tr><td><strong>Phase 1 Income</strong></td><td>${formatCurrency(d.plan1)}</td><td>${formatCurrency(d.executed1)}</td><td>${calculatePercentage(d.executed1, d.plan1)}%</td></tr>
                                        <tr><td><strong>Phase 2 Income</strong></td><td>${formatCurrency(d.plan2)}</td><td>${formatCurrency(d.executed2)}</td><td>${calculatePercentage(d.executed2, d.plan2)}%</td></tr>
                                        <tr><td><strong>Escalation Phase 1</strong></td><td>${formatCurrency(d.escaletPlan1)}</td><td>${formatCurrency(d.escaletExecuted1)}</td><td>${calculatePercentage(d.escaletExecuted1, d.escaletPlan1)}%</td></tr>
                                        <tr><td><strong>Escalation Phase 2</strong></td><td>${formatCurrency(d.escaletPlan2)}</td><td>${formatCurrency(d.escaletExecuted2)}</td><td>${calculatePercentage(d.escaletExecuted2, d.escaletPlan2)}%</td></tr>
                                        <tr class="total-row"><td><strong>TOTAL</strong></td><td>${formatCurrency(overallPlan)}</td><td>${formatCurrency(overallExecuted)}</td><td>${overallPercentage}%</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }

            // ---------- Tab Switching ----------
            function switchTab(tab) {
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`.nav-btn[data-tab="${tab}"]`).classList.add('active');

                if (tab === 'monthly') loadMonthlyTable();
                else if (tab === 'sos') loadSosTab();
                else if (tab === 'comparison') loadComparisonTab();
            }

            // Event listeners
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    switchTab(e.currentTarget.dataset.tab);
                });
            });

            // Enter to send
            document.getElementById('messageInput')?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Initialize
            document.addEventListener('DOMContentLoaded', () => {
                loadMonthlyTable();
                renderMessages();
            });
        })();
    </script>
</body>
</html>